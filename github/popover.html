<!DOCTYPE html><!--JCsUNHoMPKLZv5brQoUut--><html lang="zh"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/react-t-ui/_next/static/chunks/c57f25d7aa6d6db9.css" data-precedence="next"/><link rel="stylesheet" href="/react-t-ui/_next/static/chunks/ec8a10aa2b532d44.css" data-precedence="next"/><link rel="stylesheet" href="/react-t-ui/_next/static/chunks/373e08a226793c6d.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/react-t-ui/_next/static/chunks/b7d1a55b3ef39bbc.js"/><script src="/react-t-ui/_next/static/chunks/d73d48e9c9019a53.js" async=""></script><script src="/react-t-ui/_next/static/chunks/74ec43dceaa283e7.js" async=""></script><script src="/react-t-ui/_next/static/chunks/619b8494be332a80.js" async=""></script><script src="/react-t-ui/_next/static/chunks/turbopack-00f15764c5cb63f1.js" async=""></script><script src="/react-t-ui/_next/static/chunks/d821eddc5a83a14d.js" async=""></script><script src="/react-t-ui/_next/static/chunks/a45895e8a6f72ee9.js" async=""></script><script src="/react-t-ui/_next/static/chunks/07a06d645a86c72b.js" async=""></script><script src="/react-t-ui/_next/static/chunks/ef5d1ddf31034dc0.js" async=""></script><script src="/react-t-ui/_next/static/chunks/f129c4ead9cc822c.js" async=""></script><script src="/react-t-ui/_next/static/chunks/1b463402b9814e2f.js" async=""></script><script src="/react-t-ui/_next/static/chunks/1ebf659cd03b1565.js" async=""></script><script src="/react-t-ui/_next/static/chunks/007e0171044f4757.js" async=""></script><script src="/react-t-ui/_next/static/chunks/f623eaf7cdb053fc.js" async=""></script><script src="/react-t-ui/_next/static/chunks/6119c141ed8a8242.js" async=""></script><title>组件库教程社区</title><meta name="author" content="孟祥同学"/><link rel="icon" href="/favicon.ico"/><meta name="description" content="前端动效成长社区，分享前端动效相关的知识和经验，包括 gsap、motion、three.js 等。"/><meta name="keywords" content="&#x27;前端动效&#x27;, &#x27;前端&#x27;, &#x27;前端动画课程&#x27;, &#x27;前端动画课&#x27;, &#x27;前端动画教程&#x27;, &#x27;前端动画社区&#x27;, &#x27;动效&#x27;, &#x27;gsap&#x27;, &#x27;react gsap&#x27;, &#x27;vue gsap&#x27;, &#x27;next gsap&#x27;, &#x27;gsap 3&#x27;, &#x27;motion&#x27;, &#x27;framer-motion&#x27;, &#x27;vue motion&#x27;, &#x27;vue framer-motion&#x27;, &#x27;next motion&#x27;, &#x27;react motion&#x27;, &#x27;three.js&#x27;, &#x27;threejs 动画&#x27;, &#x27;blender&#x27;, &#x27;blender 动画&#x27;, &#x27;react-three-fiber&#x27;, &#x27;three.js 动画&#x27;, &#x27;three.js 3d&#x27;"/><link rel="icon" href="/react-t-ui/favicon.ico?favicon.176b088f.ico" sizes="128x128" type="image/x-icon"/><script src="/react-t-ui/_next/static/chunks/a6dad97d9634a72d.js" noModule=""></script></head><body class="text-color bg-color font-sans"><div hidden=""><!--$--><!--/$--></div><script>
   ((a,b)=>{let c=localStorage.getItem(b)||a;localStorage.setItem(b,c),document.documentElement.setAttribute("class",c)})('light', 'theme');
  </script><!--$?--><template id="B:0"></template><div class="flex items-center justify-center h-screen bg-white"><div class="animate-spin rounded-full h-16 w-16 border-t-4 border-blue-500 border-opacity-70"></div></div><!--/$--><script>requestAnimationFrame(function(){$RT=performance.now()});</script><script src="/react-t-ui/_next/static/chunks/b7d1a55b3ef39bbc.js" id="_R_" async=""></script><div hidden id="S:0"><div class="px-6 py-2 bg-gradient-to-r from-pink-500/15 via-purple-500/10 to-blue-500/15 text-[#9b8691] flex justify-center text-sm">组件仍在补充, 欢迎加群交流哦，微信: a2298613245</div><nav class="sticky top-0 w-full flex justify-between items-center pl-6 pr-6 h-16 border-b border-solid border-color bg-color z-[999]"><div class="text-sm flex cursor-pointer items-center"><svg class="text-4xl" width="1em" height="1em" focusable="false" stroke="none" fill="currentColor" viewBox="0 0 300 300"><g filter="url(#filter0_dddi_801_107)"><path d="M8.34992 62.1685L12.5726 37.1704C15.4175 20.3286 30.0033 8 47.0837 8H251.245C263.762 8 273.204 19.369 270.904 31.6738L266.839 53.4291C263.744 69.993 249.285 82 232.435 82H182.535C177.284 82 172.765 85.7115 171.744 90.8625L138.384 259.273C134.674 278.004 118.241 291.5 99.1464 291.5H96.5109C78.8888 291.5 65.6476 275.416 69.0322 258.122L101.4 92.7285C102.488 87.1698 98.2322 82 92.5679 82H25.1124C14.5924 82 6.5977 72.5416 8.34992 62.1685Z" fill="url(#paint0_linear_801_107)"></path></g><defs><filter id="filter0_dddi_801_107" x="0.10791" y="0" width="295.143" height="315.5" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"></feColorMatrix><feOffset dx="2" dy="2"></feOffset><feComposite in2="hardAlpha" operator="out"></feComposite><feColorMatrix type="matrix" values="0 0 0 0 0.235294 0 0 0 0 0.607843 0 0 0 0 0.882353 0 0 0 1 0"></feColorMatrix><feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_801_107"></feBlend><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"></feColorMatrix><feOffset dx="12" dy="12"></feOffset><feGaussianBlur stdDeviation="6"></feGaussianBlur><feComposite in2="hardAlpha" operator="out"></feComposite><feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.05 0"></feColorMatrix><feBlend mode="normal" in2="effect1_dropShadow_801_107" result="effect2_dropShadow_801_107"></feBlend><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"></feColorMatrix><feOffset dx="4" dy="4"></feOffset><feGaussianBlur stdDeviation="6"></feGaussianBlur><feComposite in2="hardAlpha" operator="out"></feComposite><feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.05 0"></feColorMatrix><feBlend mode="normal" in2="effect2_dropShadow_801_107" result="effect3_dropShadow_801_107"></feBlend><feBlend mode="normal" in="SourceGraphic" in2="effect3_dropShadow_801_107" result="shape"></feBlend><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"></feColorMatrix><feOffset dx="-1" dy="-1"></feOffset><feGaussianBlur stdDeviation="1"></feGaussianBlur><feComposite in2="hardAlpha" operator="arithmetic" k2="-1" k3="1"></feComposite><feColorMatrix type="matrix" values="0 0 0 0 1 0 0 0 0 1 0 0 0 0 1 0 0 0 0.14 0"></feColorMatrix><feBlend mode="normal" in2="shape" result="effect4_innerShadow_801_107"></feBlend></filter><linearGradient id="paint0_linear_801_107" x1="86.5" y1="8" x2="140" y2="259" gradientUnits="userSpaceOnUse"><stop stop-color="#6CC5FB"></stop><stop offset="1" stop-color="#4DADEE"></stop></linearGradient></defs></svg><span class="text-xl mt-[6px] text-nowrap">headless <span class="text-primary-hover dark:text-[#4cc3fa]">ui</span></span></div><div class="flex gap-x-2 items-center"><div class="mr-2"><div class="hover:bg-slate-50 px-2 py-0.5 text-sm border border-color rounded-lg"><div class="cursor-pointer"><div style="overflow:hidden;display:flex;flex-direction:column"><div style="display:flex"><span class="line1">导</span><span class="line1"> </span><span class="line1">航</span></div></div></div></div><div class="menu-overlay fixed top-0 left-0 w-screen h-screen px-6 py-5 bg-[#f6c646] z-[2] flex" style="clip-path:polygon(0 0, 100% 0, 100% 0, 0 0)"><div class="absolute group bottom-20 left-1/2 g active:text-slate-400 px-4 py-2 rounded-md cursor-pointer w-7 h-7 flex justify-center items-center bg-[#0a0a0a] text-[#f5c747]"><div class="group-hover:rotate-180 duration-300">✕</div></div><div class="mt-2 px-12 w-full font-geist-sans"><div class="text-[#fff99f] mb-10">组件还在补充中，希望能够帮助你有一个亮点项目放入简历！</div><div class="md:w-1/4 w-full text-[#191919]"><div class="h-[1px] w-full bg-[#5f5635] overflow-hidden mb-[6px]"></div><div class="px-1"><div class="text-base text-black/40"></div><div class="mt-[24px]"><div class="text-xl tracking-wide cursor-pointer "><span class="relative after:absolute after:bg-black after:bottom-[-2px] after:left-0 after:h-[2px] after:w-full after:origin-bottom-right after:scale-x-0 hover:after:origin-bottom-left hover:after:scale-x-100 after:transition-transform after:ease-in-out after:duration-300">全局方案</span></div><div class="text-xl tracking-wide cursor-pointer mt-3"><span class="relative after:absolute after:bg-black after:bottom-[-2px] after:left-0 after:h-[2px] after:w-full after:origin-bottom-right after:scale-x-0 hover:after:origin-bottom-left hover:after:scale-x-100 after:transition-transform after:ease-in-out after:duration-300">按钮 Button</span></div><div class="text-xl tracking-wide cursor-pointer mt-3"><span class="relative after:absolute after:bg-black after:bottom-[-2px] after:left-0 after:h-[2px] after:w-full after:origin-bottom-right after:scale-x-0 hover:after:origin-bottom-left hover:after:scale-x-100 after:transition-transform after:ease-in-out after:duration-300">图标 Icon</span></div><div class="text-xl tracking-wide cursor-pointer mt-3"><span class="relative after:absolute after:bg-black after:bottom-[-2px] after:left-0 after:h-[2px] after:w-full after:origin-bottom-right after:scale-x-0 hover:after:origin-bottom-left hover:after:scale-x-100 after:transition-transform after:ease-in-out after:duration-300">布局 Grid</span></div><div class="text-xl tracking-wide cursor-pointer mt-3"><span class="relative after:absolute after:bg-black after:bottom-[-2px] after:left-0 after:h-[2px] after:w-full after:origin-bottom-right after:scale-x-0 hover:after:origin-bottom-left hover:after:scale-x-100 after:transition-transform after:ease-in-out after:duration-300">间距 Space</span></div><div class="text-xl tracking-wide cursor-pointer mt-3"><span class="relative after:absolute after:bg-black after:bottom-[-2px] after:left-0 after:h-[2px] after:w-full after:origin-bottom-right after:scale-x-0 hover:after:origin-bottom-left hover:after:scale-x-100 after:transition-transform after:ease-in-out after:duration-300">输入框 Input</span></div><div class="text-xl tracking-wide cursor-pointer mt-3"><span class="relative after:absolute after:bg-black after:bottom-[-2px] after:left-0 after:h-[2px] after:w-full after:origin-bottom-right after:scale-x-0 hover:after:origin-bottom-left hover:after:scale-x-100 after:transition-transform after:ease-in-out after:duration-300">弹窗 Modal</span></div><div class="text-xl tracking-wide cursor-pointer mt-3"><span class="relative after:absolute after:bg-black after:bottom-[-2px] after:left-0 after:h-[2px] after:w-full after:origin-bottom-right after:scale-x-0 hover:after:origin-bottom-left hover:after:scale-x-100 after:transition-transform after:ease-in-out after:duration-300">弹出框 Popover</span></div><div class="text-xl tracking-wide cursor-pointer mt-3"><span class="relative after:absolute after:bg-black after:bottom-[-2px] after:left-0 after:h-[2px] after:w-full after:origin-bottom-right after:scale-x-0 hover:after:origin-bottom-left hover:after:scale-x-100 after:transition-transform after:ease-in-out after:duration-300">消息 Toast</span></div><div class="text-xl tracking-wide cursor-pointer mt-3"><span class="relative after:absolute after:bg-black after:bottom-[-2px] after:left-0 after:h-[2px] after:w-full after:origin-bottom-right after:scale-x-0 hover:after:origin-bottom-left hover:after:scale-x-100 after:transition-transform after:ease-in-out after:duration-300">警告 Alert</span></div></div></div></div></div></div></div><a class="inline-flex relative items-center justify-center outline-none h-8 text-sm appearance-none select-none cursor-pointer whitespace-nowrap transition-all duration-200 ease-linear box-border rounded text-color hover:bg-color-100 active:bg-color-200 focus-visible:border-color border border-transparent border-solid pl-2 pr-2" href="https://github.com/lio-mengxiang/mx-design" target="_blank"><svg width="20px" height="20px" focusable="false" stroke="none" fill="currentColor" viewBox="0 0 48 48"><path fill-rule="evenodd" clip-rule="evenodd" d="M24 4C12.9543 4 4 12.9543 4 24C4 35.0457 12.9543 44 24 44C35.0457 44 44 35.0457 44 24C44 12.9543 35.0457 4 24 4ZM0 24C0 10.7452 10.7452 0 24 0C37.2548 0 48 10.7452 48 24C48 37.2548 37.2548 48 24 48C10.7452 48 0 37.2548 0 24Z"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M19.1833 45.4716C18.9898 45.2219 18.9898 42.9973 19.1833 38.798C17.1114 38.8696 15.8024 38.7258 15.2563 38.3667C14.437 37.828 13.6169 36.1667 12.8891 34.9959C12.1614 33.8251 10.5463 33.64 9.89405 33.3783C9.24182 33.1165 9.07809 32.0496 11.6913 32.8565C14.3044 33.6634 14.4319 35.8607 15.2563 36.3745C16.0806 36.8883 18.0515 36.6635 18.9448 36.2519C19.8382 35.8403 19.7724 34.3078 19.9317 33.7007C20.1331 33.134 19.4233 33.0083 19.4077 33.0037C18.5355 33.0037 13.9539 32.0073 12.6955 27.5706C11.437 23.134 13.0581 20.2341 13.9229 18.9875C14.4995 18.1564 14.4485 16.3852 13.7699 13.6737C16.2335 13.3589 18.1347 14.1343 19.4734 16.0001C19.4747 16.0108 21.2285 14.9572 24.0003 14.9572C26.772 14.9572 27.7553 15.8154 28.5142 16.0001C29.2731 16.1848 29.88 12.7341 34.5668 13.6737C33.5883 15.5969 32.7689 18.0001 33.3943 18.9875C34.0198 19.9749 36.4745 23.1147 34.9666 27.5706C33.9614 30.5413 31.9853 32.3523 29.0384 33.0037C28.7005 33.1115 28.5315 33.2855 28.5315 33.5255C28.5315 33.8856 28.9884 33.9249 29.6465 35.6117C30.0853 36.7362 30.117 39.948 29.7416 45.247C28.7906 45.4891 28.0508 45.6516 27.5221 45.7347C26.5847 45.882 25.5669 45.9646 24.5669 45.9965C23.5669 46.0284 23.2196 46.0248 21.837 45.8961C20.9154 45.8103 20.0308 45.6688 19.1833 45.4716Z"></path></svg></a><button class="inline-flex relative items-center justify-center outline-none h-8 text-sm appearance-none select-none cursor-pointer whitespace-nowrap transition-all duration-200 ease-linear box-border rounded text-color hover:bg-color-100 active:bg-color-200 focus-visible:border-color border border-transparent border-solid pl-2 pr-2" type="button"><div class="w-5 h-5 bg-color-200 border border-solid rounded"></div></button></div></nav><main class="flex w-full"><div class="sticky top-[60px] overflow-hidden pt-4 pl-3 border-r border-solid border-color shrink-0 h-[calc(100vh_-_60px)] transition-all duration-300 ease-in-out" style="width:250px"><div class="z-0 h-[calc(100vh-60px)] overflow-auto" style="visibility:visible"><div><div class="pt-3 pb-3 pl-4 pr-4 hover:bg-color-50  cursor-pointer rounded mb-1 w-60"><span class="flex items-center"><div style="width:NaNem"></div><svg class="text-[#FBCD2C] mr-2" width="1.4em" height="1.4em" focusable="false" stroke="none" fill="currentColor" viewBox="0 0 48 48"><path xmlns="http://www.w3.org/2000/svg" d="M26.285,2.486l5.407,10.956c0.376,0.762,1.103,1.29,1.944,1.412l12.091,1.757  c2.118,0.308,2.963,2.91,1.431,4.403l-8.749,8.528c-0.608,0.593-0.886,1.448-0.742,2.285l2.065,12.042  c0.362,2.109-1.852,3.717-3.746,2.722l-10.814-5.685c-0.752-0.395-1.651-0.395-2.403,0l-10.814,5.685  c-1.894,0.996-4.108-0.613-3.746-2.722l2.065-12.042c0.144-0.837-0.134-1.692-0.742-2.285l-8.749-8.528  c-1.532-1.494-0.687-4.096,1.431-4.403l12.091-1.757c0.841-0.122,1.568-0.65,1.944-1.412l5.407-10.956  C22.602,0.567,25.338,0.567,26.285,2.486z"></path></svg>必读指南</span></div><div><div class="hover:bg-color-50 pt-3 pb-3 pl-4 pr-4 cursor-pointer flex justify-between items-center mb-0.5 rounded w-full"><span class="flex items-center gap-x-2"><svg class="text-[#4cc3fa]" width="1.4em" height="1.4em" focusable="false" stroke="none" fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" clip-rule="evenodd" d="M23 12c0 3.542-2.869 3.968-5.512 4.36-1.461.216-2.854.423-3.655 1.14-.846.757-.523 1.895-.227 2.94C13.991 21.8 14.332 23 12 23 5.925 23 1 18.075 1 12S5.925 1 12 1s11 4.925 11 11zm-2.292-.688a2.062 2.062 0 11-4.125 0 2.062 2.062 0 014.125 0zM14.98 7.876a2.062 2.062 0 100-4.125 2.062 2.062 0 000 4.125zm-4.354-2.063a2.062 2.062 0 11-4.125 0 2.062 2.062 0 014.125 0zm-5.73 7.563a2.062 2.062 0 100-4.125 2.062 2.062 0 000 4.125z"></path></svg> 如何自定义 Popover</span><svg width="1em" height="1em" focusable="false" stroke="currentColor" fill="none" viewBox="0 0 48 48"><path d="M36 18L24 30L12 18" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"></path></svg></div><div style="overflow:hidden;height:0px"><div><div class="pt-3 pb-3 pl-4 pr-4 hover:bg-color-50  cursor-pointer rounded mb-1 w-full"><span class="flex items-center text-sm font-light"><div style="width:2.4em"></div>CSS / Less / Sass Popover</span></div><div class="pt-3 pb-3 pl-4 pr-4 hover:bg-color-50  cursor-pointer rounded mb-1 w-full"><span class="flex items-center text-sm font-light"><div style="width:2.4em"></div>Tailwind Popover</span></div></div></div></div><div><div class="hover:bg-color-50 pt-3 pb-3 pl-4 pr-4 cursor-pointer flex justify-between items-center mb-0.5 rounded w-full"><span class="flex items-center gap-x-2"><svg class="text-[#4cc3fa]" width="1.6em" height="1.6em" focusable="false" stroke="currentColor" fill="currentColor" viewBox="0 0 48 48"><path d="M24 4V12" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M22 22L42 26L36 30L42 36L36 42L30 36L26 42L22 22Z" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"></path><path d="M38.1421 9.85789L32.4853 15.5147" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"></path><path d="M9.85787 38.1421L15.5147 32.4853" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"></path><path d="M4 24H12" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"></path><path d="M9.85795 9.85787L15.5148 15.5147" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"></path></svg> Popover 完整案例</span><svg width="1em" height="1em" focusable="false" stroke="currentColor" fill="none" viewBox="0 0 48 48"><path d="M36 18L24 30L12 18" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"></path></svg></div><div style="overflow:hidden;height:0px"><div><div class="pt-3 pb-3 pl-4 pr-4 hover:bg-color-50  cursor-pointer rounded mb-1 w-full"><span class="flex items-center text-sm font-light"><div style="width:2.4em"></div>传统案例</span></div><div class="pt-3 pb-3 pl-4 pr-4 hover:bg-color-50  cursor-pointer rounded mb-1 w-full"><span class="flex items-center text-sm font-light"><div style="width:2.4em"></div>创意案例</span></div></div></div></div></div></div><div class="fixed flex items-center justify-center text-lg text-color-500 border border-color-500 rounded-full p-1 bg-color top-56 translate-y-[-50%] cursor-pointer transition-all duration-300 ease-in-out" style="left:236px"><svg width="1em" height="1em" focusable="false" stroke="currentColor" fill="none" viewBox="0 0 48 48"><path d="M31 36L19 24L31 12" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"></path></svg></div></div><div class="grow shrink basis-0 overflow-hidden mx-16 mt-8 mb-12"><h1 class="font-medium mb-8 text-[36px]" id="弹框组件核心难点概要">弹框组件核心难点概要<div class="text-xl font-normal text-color-400">功能说明</div></h1>
<div class="w-full h-96 relative mt-8 mb-8 undefined"><img alt="popover" loading="lazy" decoding="async" data-nimg="fill" class="object-cover" style="position:absolute;height:100%;width:100%;left:0;top:0;right:0;bottom:0;color:transparent" src="/react-t-ui/popover/popover.webp"/></div>
<h2 class="font-medium mb-8 mt-8 text-[28px]" id="基础使用">基础使用</h2>
<p class="leading-8 break-all whitespace-normal mb-8 mt-8">T-UI 的 Popover(弹框) 只封装了基础的弹出逻辑，没有加入任何 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">css</code> 样式，也就是不跟任何 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">css</code> 框架耦合，
你可以选择自己业务中使用的 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">css</code> 框架进行进一步封装。</p>
<p class="leading-8 break-all whitespace-normal mb-8 mt-8">以下是基本功能展示(使用 style 简单封装了样式)，大家可以 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">hover</code> 以下的按钮，看看弹框组件是什么。</p>
<div class="relative p-12 overflow-hidden min-w-25 border border-solid border-color rounded-md"><div><button class="inline-flex relative items-center justify-center outline-none pl-3.5 pr-3.5 h-8 text-sm appearance-none select-none cursor-pointer whitespace-nowrap transition-all duration-200 ease-linear box-border rounded border border-transparent bg-blue-600 text-white hover:bg-blue-500 active:bg-blue-700 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary-focus" data-visible="false" type="button">Open</button></div></div><div class="pt-3"><div class="flex justify-end mb-3"><div class="flex items-center text-xs text-color-400 hover:bg-color-100 px-2 py-1 rounded-md cursor-pointer border border-solid border-color"><span class="mr-1">编辑代码</span><svg width="14px" height="14px" focusable="false" stroke="currentColor" fill="none" viewBox="0 0 48 48"><path stroke-width="4" d="M16.734 12.686 5.42 24l11.314 11.314m14.521-22.628L42.57 24 31.255 35.314M27.2 6.28l-6.251 35.453"></path></svg></div></div><div class="overflow-hidden" style="height:0px"><div class="cm-theme max-h-125 overflow-auto text-sm"></div></div></div>
<p class="leading-8 break-all whitespace-normal mb-8 mt-8">如上所示，其实就是将 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">hover</code> 出现的弹出内容，定位到另一个元素上，上面案例的另一个元素是一个 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">Button</code>, 其实是可以是任何 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">HTML</code> 元素。
但注意，这个 HTML 元素，一定要提供元素最外层 DOM 元素 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">ref</code> 引用，否则组件定位会失效（这里这是因为 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">Button</code> 组件内部，已经使用 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">React.forwardRef</code>
包裹，所以这里我们不需要关心这个问题，其它组件库基本都是类似的）。</p>
<p class="leading-8 break-all whitespace-normal mb-8 mt-8"><code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">ant-design</code> 、<code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">M-UI</code> 和 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">shadcn/ui</code>等等知名组件库都有 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">Popover</code> 组件。</p>
<p class="leading-8 break-all whitespace-normal mb-8 mt-8">这个组件非常重要，例如 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">Tooltip</code>、 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">Select</code> 等等组件，就依赖于 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">Popover</code> 组件来弹框。</p>
<p class="leading-8 break-all whitespace-normal mb-8 mt-8">需要注意的是， <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">ant-design</code> 在使用 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">Popover</code> 组件过程中一直有一个痛点：</p>
<ul class="list-disc p-0 m-6 space-y-4">
<li>不具备自动跟踪的定位的功能，也就是容器如果不是 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">window</code> 窗口，而是别的容器，在滚动条滚动的时候，需要手动
使用 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">getPopupContainer</code> 参数来指定滚动容器，否则无法自动定位。</li>
</ul>
<p class="leading-8 break-all whitespace-normal mb-8 mt-8">当时自己在开发项目的时候，很多次遇到这个问题，所以特地在自己组件库中优化了一下。</p>
<p class="leading-8 break-all whitespace-normal mb-8 mt-8">这些组件库大多数是自己实现了定位逻辑，而我们的 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">Popover</code> 组件，是基于知名的定位组件库 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">floating-ui</code> 改造，抽离核心逻辑，实现了一个 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">mini-floating-ui</code>。
这也算我们的目标之一，就是项目本身尽量不依赖任何第三方库，如果需要依赖，将其源码研究一下，抽离 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">mini</code> 版（生产环境可用的）到我们组件库里。</p>
<p class="leading-8 break-all whitespace-normal mb-8 mt-8">弹框组件算是所有组件中相对比较复杂的组件，首先最基本的，最核心要解决的就是，如何将一个 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">dom</code> 元素定位到另一个 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">dom</code> 上。接下来我们就详细谈谈，如何
实现这个逻辑。</p>
<p class="leading-8 break-all whitespace-normal mb-8 mt-8">这里我们统一定位方式是 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">absolute</code> 定位（我们的库是既支持 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">absolute</code> 定位，也支持 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">fixed</code> 定位）。</p>
<h2 class="font-medium mb-8 mt-8 text-[28px]" id="定位上下文">定位上下文</h2>
<p class="leading-8 break-all whitespace-normal mb-8 mt-8">弹框是绝对定位，那么就会有一个绝对定位的上下文，所以我们计算按钮的坐标的时候，实际上是相对于这个上下文去计算的。</p>
<p class="leading-8 break-all whitespace-normal mb-8 mt-8">相对定位的上下文是什么？举个例子，假设一个元素的 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">position</code> 属性是 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">absolute</code>，那么它是相当于谁定位？例如：</p>
<p class="leading-8 break-all whitespace-normal mb-8 mt-8">相信很多学过 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">html</code> 和 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">css</code> 同学都在很多教程和培训中了解过，即 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">position</code> 属性为 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">absolute</code> 时，相对定位的上下文是最近的 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">position</code> 属性为非 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">static</code> 定位的元素。</p>
<p class="leading-8 break-all whitespace-normal mb-8 mt-8">这个没错，但是只答对一部分，还有一些其他情况也会视为定位上下文，比如本身元素是 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">static</code> 元素也会成为定位上下文，比如给它加一个 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">transform</code> 属性，你可以试试下面的代码，李四是相对于 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">transform</code> 属性的 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">div</code> 定位的。</p>
<div class="relative w-full text-sm undefined"><div class="shrink-0 grow basis-0" style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:20px;margin:0;overflow:auto;border-radius:6px;background:#1d1f21;max-height:400px;font-size:0.875rem"><code class="language-html" style="white-space:pre;color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">1</span><span class="token" style="color:#c5c8c6">&lt;</span><span class="token" style="color:#96CBFE">body</span><span class="token" style="color:#c5c8c6">&gt;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">2</span><span>  </span><span class="token" style="color:#c5c8c6">&lt;</span><span class="token" style="color:#96CBFE">div</span><span class="token" style="color:#c5c8c6">&gt;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">3</span>    王二
</span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">4</span><span>  </span><span class="token" style="color:#c5c8c6">&lt;/</span><span class="token" style="color:#96CBFE">div</span><span class="token" style="color:#c5c8c6">&gt;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">5</span><span>  </span><span class="token" style="color:#c5c8c6">&lt;</span><span class="token" style="color:#96CBFE">div</span><span class="token" style="color:#96CBFE"> </span><span class="token special-attr" style="color:#A8FF60">style</span><span class="token special-attr attr-equals" style="color:#c5c8c6">=</span><span class="token special-attr" style="color:#c5c8c6">&quot;</span><span class="token special-attr value css language-css" style="color:#F9EE98">transform</span><span class="token special-attr value css language-css" style="color:#F9EE98">:</span><span class="token special-attr value css language-css" style="color:#F9EE98"> </span><span class="token special-attr value css language-css" style="color:#F9EE98">translateX</span><span class="token special-attr value css language-css" style="color:#F9EE98">(</span><span class="token special-attr value css language-css" style="color:#F9EE98">2</span><span class="token special-attr value css language-css unit" style="color:#F9EE98">px</span><span class="token special-attr value css language-css" style="color:#F9EE98">)</span><span class="token special-attr value css language-css" style="color:#F9EE98">;</span><span class="token special-attr" style="color:#c5c8c6">&quot;</span><span class="token" style="color:#c5c8c6">&gt;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">6</span><span>    </span><span class="token" style="color:#c5c8c6">&lt;</span><span class="token" style="color:#96CBFE">span</span><span class="token" style="color:#96CBFE"> </span><span class="token special-attr" style="color:#A8FF60">style</span><span class="token special-attr attr-equals" style="color:#c5c8c6">=</span><span class="token special-attr" style="color:#c5c8c6">&quot;</span><span class="token special-attr value css language-css" style="color:#F9EE98">position</span><span class="token special-attr value css language-css" style="color:#F9EE98">:</span><span class="token special-attr value css language-css" style="color:#F9EE98"> absolute</span><span class="token special-attr value css language-css" style="color:#F9EE98">;</span><span class="token special-attr value css language-css" style="color:#F9EE98"> </span><span class="token special-attr value css language-css" style="color:#F9EE98">top</span><span class="token special-attr value css language-css" style="color:#F9EE98">:</span><span class="token special-attr value css language-css" style="color:#F9EE98"> </span><span class="token special-attr value css language-css" style="color:#F9EE98">0</span><span class="token special-attr" style="color:#c5c8c6">&quot;</span><span class="token" style="color:#96CBFE"> </span><span class="token" style="color:#c5c8c6">&gt;</span><span>李四</span><span class="token" style="color:#c5c8c6">&lt;/</span><span class="token" style="color:#96CBFE">span</span><span class="token" style="color:#c5c8c6">&gt;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">7</span><span>  </span><span class="token" style="color:#c5c8c6">&lt;/</span><span class="token" style="color:#96CBFE">div</span><span class="token" style="color:#c5c8c6">&gt;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">8</span><span></span><span class="token" style="color:#c5c8c6">&lt;/</span><span class="token" style="color:#96CBFE">body</span><span class="token" style="color:#c5c8c6">&gt;</span></span></code></div></div>
<p class="leading-8 break-all whitespace-normal mb-8 mt-8">不仅仅是 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">transform</code> 属性，下面的方式都可以成定位上下文元素（当时看源码这里我是怎么也不明白为啥要判断下面这些）</p>
<p class="leading-8 break-all whitespace-normal mb-8 mt-8">有 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">transform</code>、<code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">perspective</code>、<code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">filter</code> 属性中任意一个不为 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">none</code>。
是 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">will-change</code> 属性值为以上任意一个属性的祖先元素。
是 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">contain</code> 属性值包含 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">paint</code>、<code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">layout</code>、<code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">strict</code> 或 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">content</code> 的祖先元素。
（注：更详细的内容请查看 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">mnd</code>，包含块的概念）</p>
<p class="leading-8 break-all whitespace-normal mb-8 mt-8">关于如何找到真正的定位上下文，我们后续会讲，这里我们先把之前第一个核心问题解决，就是如何让一个 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">dom</code> 元素定位到另一个 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">dom</code> 元素上。</p>
<p class="leading-8 break-all whitespace-normal mb-8 mt-8">这里我们假设已经找到定位上下文元素，如下图，在此基础上，如何计算要定位的元素，到按钮的距离（使用绝对定位）示意图如下：</p>
<div class="w-full h-96 relative mt-8 mb-8 undefined"><img alt="popover" loading="lazy" decoding="async" data-nimg="fill" class="object-contain" style="position:absolute;height:100%;width:100%;left:0;top:0;right:0;bottom:0;color:transparent" src="/react-t-ui/popover/context.webp"/></div>
<p class="leading-8 break-all whitespace-normal mb-8 mt-8">所以 按钮到视口顶部的距离 - 定位上下文到视口顶部的距离，就是按钮相对于定位上下的距离。</p>
<p class="leading-8 break-all whitespace-normal mb-8 mt-8">但是还需要注意，这是定位上下文没有滚动条的情况，如果定位上下文可以滚动，我们还需要加上滚动距离。至此，我们推导出了定位公式：</p>
<div class="relative w-full text-sm undefined"><div class="shrink-0 grow basis-0" style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:20px;margin:0;overflow:auto;border-radius:6px;background:#1d1f21;max-height:400px;font-size:0.875rem"><code class="language-bash" style="white-space:pre;color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">1</span><span>x </span><span class="token" style="color:#EDEDED">=</span><span>  按钮到视口左边的距离 - 定位上下文到视口左边的距离 + 定位上下文的横向滚动距离
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">2</span><span>y </span><span class="token" style="color:#EDEDED">=</span><span> 按钮到视口顶部的距离 - 定位上下文到视口顶部的距离 + 定位上下文的纵向滚动距离</span></span></code></div></div>
<p class="leading-8 break-all whitespace-normal mb-8 mt-8">还需要注意：
到视口的距离，都可以用 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">getBoundingClientRect</code> 这个API来实现，滚动距离需要区分是定位上下文是文档元素还是其他普通 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">html</code> 元素，比如 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">div</code> 元素</p>
<ul class="list-disc p-0 m-6 space-y-4">
<li>普通 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">html</code> 元素，比如 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">div</code> 元素，使用 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">scrollTop</code> 这个 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">api</code> 来获取滚动距离</li>
<li><code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">html</code> 元素，也就是文档，可以使用 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">Window.pageYOffset</code> 来获取滚动距离</li>
</ul>
<p class="leading-8 break-all whitespace-normal mb-8 mt-8">这里有个很坑的点，就是 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">document.body</code> 的 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">scrollTop</code> 是 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">0</code>，所以弹框组件一定要在发现定位上下文是 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">body</code> 的时候单独处理</p>
<p class="leading-8 break-all whitespace-normal mb-8 mt-8">当然这部分定位代码还有很多细节，有兴趣了解的伙伴，可以加入到我们的 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">超强组件库教程社区</code> 中，一起学习，一起进步。</p>
<h3 class="font-medium mb-8 mt-8 text-[20px]" id="offsetParent 的坑">offsetParent 的坑</h3>
<p class="leading-8 break-all whitespace-normal mb-8 mt-8">接下来，我们要抓到什么是定位上下文，一般情况下，我们会使用 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">offsetParent</code>, 但是它有坑，
以下是 `mnd 对其的介绍：</p>
<ul class="list-disc p-0 m-6 space-y-4">
<li><code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">HTMLElement.offsetParent</code> 是一个只读属性，返回一个指向最近的（指包含层级上的最近）包含该元素的定位元素或者最近的 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">table</code>, <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">td</code>, <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">th</code>, <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">body</code> 元素。当元素的 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">style.display</code> 设置为 &quot;none&quot; 时，<code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">offsetParent</code> 返回 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">null</code>。
也就是说，<code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">table</code>, <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">td</code>, <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">th</code>, <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">body</code> 元素，我们要做特殊处理，因为我们是想获取最近的定位的父元素，但是这几个，比如body元素就算是static定位，也会被获取到，我们就要排除这些可能。</li>
</ul>
<p class="leading-8 break-all whitespace-normal mb-8 mt-8">所以我们要实现一个更好版本的 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">offsetParent</code>, 后面会逐行解释代码</p>
<div class="relative w-full text-sm undefined"><div class="shrink-0 grow basis-0" style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:20px;margin:0;overflow:auto;border-radius:6px;background:#1d1f21;max-height:400px;font-size:0.875rem"><code class="language-javascript" style="white-space:pre;color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">1</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">2</span><span></span><span class="token" style="color:#96CBFE">function</span><span> </span><span class="token" style="color:#DAD085">getOffsetParent</span><span class="token" style="color:#c5c8c6">(</span><span class="token parameter literal-property" style="color:#96CBFE">element</span><span class="token parameter" style="color:#EDEDED">:</span><span class="token parameter"> </span><span class="token parameter maybe-class-name">HTMLElement</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#EDEDED">:</span><span> </span><span class="token maybe-class-name">Element</span><span> </span><span class="token" style="color:#EDEDED">|</span><span> </span><span class="token maybe-class-name">Window</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">3</span><span>  </span><span class="token" style="color:#96CBFE">let</span><span> offsetParent </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#DAD085">getTrueOffsetParent</span><span class="token" style="color:#c5c8c6">(</span><span>element</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">4</span><span>  </span><span class="token" style="color:#7C7C7C">// https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLElement/offsetParent</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">5</span><span>  </span><span class="token control-flow" style="color:#96CBFE">while</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span>offsetParent </span><span class="token" style="color:#EDEDED">&amp;&amp;</span><span> </span><span class="token" style="color:#DAD085">isTableElement</span><span class="token" style="color:#c5c8c6">(</span><span>offsetParent</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#EDEDED">&amp;&amp;</span><span> </span><span class="token" style="color:#DAD085">getComputedStyle</span><span class="token" style="color:#c5c8c6">(</span><span>offsetParent</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">.</span><span class="token property-access">position</span><span> </span><span class="token" style="color:#EDEDED">===</span><span> </span><span class="token" style="color:#A8FF60">&#x27;static&#x27;</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">6</span><span>    offsetParent </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#DAD085">getTrueOffsetParent</span><span class="token" style="color:#c5c8c6">(</span><span>offsetParent </span><span class="token module" style="color:#96CBFE">as</span><span> </span><span class="token maybe-class-name">HTMLElement</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">7</span><span>  </span><span class="token" style="color:#c5c8c6">}</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">8</span><span>  </span><span class="token" style="color:#7C7C7C">// https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLElement/offsetParent</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">9</span><span>  </span><span class="token control-flow" style="color:#96CBFE">if</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">10</span><span>    offsetParent </span><span class="token" style="color:#EDEDED">&amp;&amp;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">11</span><span>    </span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#DAD085">getNodeName</span><span class="token" style="color:#c5c8c6">(</span><span>offsetParent</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#EDEDED">===</span><span> </span><span class="token" style="color:#A8FF60">&#x27;html&#x27;</span><span> </span><span class="token" style="color:#EDEDED">||</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">12</span><span>      </span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#DAD085">getNodeName</span><span class="token" style="color:#c5c8c6">(</span><span>offsetParent</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#EDEDED">===</span><span> </span><span class="token" style="color:#A8FF60">&#x27;body&#x27;</span><span> </span><span class="token" style="color:#EDEDED">&amp;&amp;</span><span> </span><span class="token" style="color:#DAD085">getComputedStyle</span><span class="token" style="color:#c5c8c6">(</span><span>offsetParent</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">.</span><span class="token property-access">position</span><span> </span><span class="token" style="color:#EDEDED">===</span><span> </span><span class="token" style="color:#A8FF60">&#x27;static&#x27;</span><span> </span><span class="token" style="color:#EDEDED">&amp;&amp;</span><span> </span><span class="token" style="color:#EDEDED">!</span><span class="token" style="color:#DAD085">isContainingBlock</span><span class="token" style="color:#c5c8c6">(</span><span>offsetParent</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">)</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">13</span><span>  </span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">14</span><span>    </span><span class="token control-flow" style="color:#96CBFE">return</span><span> </span><span class="token dom" style="color:#C6C5FE">window</span><span class="token" style="color:#c5c8c6">;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">15</span><span>  </span><span class="token" style="color:#c5c8c6">}</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">16</span><span>  </span><span class="token control-flow" style="color:#96CBFE">return</span><span> offsetParent </span><span class="token" style="color:#EDEDED">||</span><span> </span><span class="token" style="color:#DAD085">getContainingBlock</span><span class="token" style="color:#c5c8c6">(</span><span>element</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#EDEDED">||</span><span> </span><span class="token dom" style="color:#C6C5FE">window</span><span class="token" style="color:#c5c8c6">;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">17</span><span></span><span class="token" style="color:#c5c8c6">}</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">18</span></span></code></div></div>
<p class="leading-8 break-all whitespace-normal mb-8 mt-8">首先解释:</p>
<div class="relative w-full text-sm undefined"><div class="shrink-0 grow basis-0" style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:20px;margin:0;overflow:auto;border-radius:6px;background:#1d1f21;max-height:400px;font-size:0.875rem"><code class="language-javascript" style="white-space:pre;color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">1</span><span class="token" style="color:#96CBFE">let</span><span> offsetParent </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#DAD085">getTrueOffsetParent</span><span class="token" style="color:#c5c8c6">(</span><span>element</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span></span></code></div></div>
<p class="leading-8 break-all whitespace-normal mb-8 mt-8"><code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">getTrueOffsetParent</code> 要排除一些特殊情况，而不是直接使用 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">element.offsetParent</code> 来获取 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">offsetParent</code>，因为例如 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">element</code> 不是 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">HTMLElement</code> 类型，它是没有 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">offsetParent</code> 这个属性的，所以此时如果不是对应的类型要返回 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">null</code>
还有，如果一个 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">dom</code> 元素是 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">position</code> 是 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">fixed</code>，它的 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">offsetParent</code> 属性也是 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">null</code></p>
<p class="leading-8 break-all whitespace-normal mb-8 mt-8">接着</p>
<div class="relative w-full text-sm undefined"><div class="shrink-0 grow basis-0" style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:20px;margin:0;overflow:auto;border-radius:6px;background:#1d1f21;max-height:400px;font-size:0.875rem"><code class="language-javascript" style="white-space:pre;color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">1</span><span class="token control-flow" style="color:#96CBFE">while</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span>offsetParent </span><span class="token" style="color:#EDEDED">&amp;&amp;</span><span> </span><span class="token" style="color:#DAD085">isTableElement</span><span class="token" style="color:#c5c8c6">(</span><span>offsetParent</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#EDEDED">&amp;&amp;</span><span> </span><span class="token" style="color:#DAD085">getComputedStyle</span><span class="token" style="color:#c5c8c6">(</span><span>offsetParent</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">.</span><span class="token property-access">position</span><span> </span><span class="token" style="color:#EDEDED">===</span><span> </span><span class="token" style="color:#A8FF60">&#x27;static&#x27;</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">2</span><span>  offsetParent </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#DAD085">getTrueOffsetParent</span><span class="token" style="color:#c5c8c6">(</span><span>offsetParent </span><span class="token module" style="color:#96CBFE">as</span><span> </span><span class="token maybe-class-name">HTMLElement</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">3</span><span></span><span class="token" style="color:#c5c8c6">}</span></span></code></div></div>
<p class="leading-8 break-all whitespace-normal mb-8 mt-8"><code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">isTableElement</code> 的实现：</p>
<div class="relative w-full text-sm undefined"><div class="shrink-0 grow basis-0" style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:20px;margin:0;overflow:auto;border-radius:6px;background:#1d1f21;max-height:400px;font-size:0.875rem"><code class="language-javascript" style="white-space:pre;color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">1</span><span class="token module" style="color:#96CBFE">export</span><span> </span><span class="token" style="color:#96CBFE">function</span><span> </span><span class="token" style="color:#DAD085">isTableElement</span><span class="token" style="color:#c5c8c6">(</span><span class="token parameter literal-property" style="color:#96CBFE">element</span><span class="token parameter" style="color:#EDEDED">:</span><span class="token parameter"> </span><span class="token parameter maybe-class-name">Element</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#EDEDED">:</span><span> boolean </span><span class="token" style="color:#c5c8c6">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">2</span><span>  </span><span class="token control-flow" style="color:#96CBFE">return</span><span> </span><span class="token" style="color:#c5c8c6">[</span><span class="token" style="color:#A8FF60">&#x27;table&#x27;</span><span class="token" style="color:#c5c8c6">,</span><span> </span><span class="token" style="color:#A8FF60">&#x27;td&#x27;</span><span class="token" style="color:#c5c8c6">,</span><span> </span><span class="token" style="color:#A8FF60">&#x27;th&#x27;</span><span class="token" style="color:#c5c8c6">]</span><span class="token" style="color:#c5c8c6">.</span><span class="token method property-access" style="color:#DAD085">indexOf</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#DAD085">getNodeName</span><span class="token" style="color:#c5c8c6">(</span><span>element</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#EDEDED">&gt;=</span><span> </span><span class="token" style="color:#FF73FD">0</span><span class="token" style="color:#c5c8c6">;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">3</span><span></span><span class="token" style="color:#c5c8c6">}</span></span></code></div></div>
<p class="leading-8 break-all whitespace-normal mb-8 mt-8">以上代码排除了之前我们说的 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">&#x27;table&#x27;, &#x27;td&#x27;, &#x27;th&#x27;</code> 元素，因为它们可能会得到错误的 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">offsetParent</code>
但是这里的写法我觉得是有 bug 的，因为如果这些 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">table</code> 元素有 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">transform</code>，就是他们是包含块的话，依然可以是定位上下文（现实中几乎遇不到这种情况），所以还需要判断是否是包含块，这样就可以返回这些 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">table</code> 元素了。</p>
<p class="leading-8 break-all whitespace-normal mb-8 mt-8">接着：</p>
<div class="relative w-full text-sm undefined"><div class="shrink-0 grow basis-0" style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:20px;margin:0;overflow:auto;border-radius:6px;background:#1d1f21;max-height:400px;font-size:0.875rem"><code class="language-javascript" style="white-space:pre;color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">1</span><span class="token control-flow" style="color:#96CBFE">if</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">2</span><span>  offsetParent </span><span class="token" style="color:#EDEDED">&amp;&amp;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">3</span><span>  </span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#DAD085">getNodeName</span><span class="token" style="color:#c5c8c6">(</span><span>offsetParent</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#EDEDED">===</span><span> </span><span class="token" style="color:#A8FF60">&#x27;html&#x27;</span><span> </span><span class="token" style="color:#EDEDED">||</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">4</span><span>    </span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#DAD085">getNodeName</span><span class="token" style="color:#c5c8c6">(</span><span>offsetParent</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#EDEDED">===</span><span> </span><span class="token" style="color:#A8FF60">&#x27;body&#x27;</span><span> </span><span class="token" style="color:#EDEDED">&amp;&amp;</span><span> </span><span class="token" style="color:#DAD085">getComputedStyle</span><span class="token" style="color:#c5c8c6">(</span><span>offsetParent</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">.</span><span class="token property-access">position</span><span> </span><span class="token" style="color:#EDEDED">===</span><span> </span><span class="token" style="color:#A8FF60">&#x27;static&#x27;</span><span> </span><span class="token" style="color:#EDEDED">&amp;&amp;</span><span> </span><span class="token" style="color:#EDEDED">!</span><span class="token" style="color:#DAD085">isContainingBlock</span><span class="token" style="color:#c5c8c6">(</span><span>offsetParent</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">)</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">5</span><span></span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">6</span><span>  </span><span class="token control-flow" style="color:#96CBFE">return</span><span> </span><span class="token dom" style="color:#C6C5FE">window</span><span class="token" style="color:#c5c8c6">;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">7</span><span></span><span class="token" style="color:#c5c8c6">}</span></span></code></div></div>
<p class="leading-8 break-all whitespace-normal mb-8 mt-8">你看，上面这里处理 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">body</code> 这种特殊的 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">offsetParent</code> 的情况，同时还判断了是否是包含块，因为即使一个 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">dom</code> 元素的 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">offsetParent</code> 是 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">body</code>，定位是 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">static</code>，得到错误的 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">offsetParent</code>，但是如果 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">body</code> 元素是包含块，绝对定位依然是拿它当做定位上下文的。
最后，代码里 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">offsetParent</code> 设置了一个封顶，基本上到 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">html</code>，就结束寻找了，统一返回 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">window</code></p>
<p class="leading-8 break-all whitespace-normal mb-8 mt-8">接着：</p>
<div class="relative w-full text-sm undefined"><div class="shrink-0 grow basis-0" style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:20px;margin:0;overflow:auto;border-radius:6px;background:#1d1f21;max-height:400px;font-size:0.875rem"><code class="language-javascript" style="white-space:pre;color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">1</span><span class="token control-flow" style="color:#96CBFE">return</span><span> offsetParent </span><span class="token" style="color:#EDEDED">||</span><span> </span><span class="token" style="color:#DAD085">getContainingBlock</span><span class="token" style="color:#c5c8c6">(</span><span>element</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#EDEDED">||</span><span> </span><span class="token dom" style="color:#C6C5FE">window</span></span></code></div></div>
<p class="leading-8 break-all whitespace-normal mb-8 mt-8">如果 offsetParent 没有得到 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">dom</code> 元素的值，就会寻找包含块，最后用 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">window</code> 元素兜底（包含块也不存在）</p>
<p class="leading-8 break-all whitespace-normal mb-8 mt-8">我们附上判断包含块的函数：</p>
<div class="relative w-full text-sm undefined"><div class="shrink-0 grow basis-0" style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:20px;margin:0;overflow:auto;border-radius:6px;background:#1d1f21;max-height:400px;font-size:0.875rem"><code class="language-javascript" style="white-space:pre;color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">1</span><span class="token module" style="color:#96CBFE">export</span><span> </span><span class="token" style="color:#96CBFE">function</span><span> </span><span class="token" style="color:#DAD085">getContainingBlock</span><span class="token" style="color:#c5c8c6">(</span><span class="token parameter literal-property" style="color:#96CBFE">element</span><span class="token parameter" style="color:#EDEDED">:</span><span class="token parameter"> </span><span class="token parameter maybe-class-name">Element</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#EDEDED">:</span><span> </span><span class="token maybe-class-name">HTMLElement</span><span> </span><span class="token" style="color:#EDEDED">|</span><span> </span><span class="token null nil" style="color:#96CBFE">null</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">2</span><span>  </span><span class="token" style="color:#96CBFE">let</span><span> </span><span class="token literal-property" style="color:#96CBFE">currentNode</span><span class="token" style="color:#EDEDED">:</span><span> </span><span class="token maybe-class-name">Node</span><span> </span><span class="token" style="color:#EDEDED">|</span><span> </span><span class="token null nil" style="color:#96CBFE">null</span><span> </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#DAD085">getParentNode</span><span class="token" style="color:#c5c8c6">(</span><span>element</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">3</span><span>  </span><span class="token control-flow" style="color:#96CBFE">while</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#DAD085">isHTMLElement</span><span class="token" style="color:#c5c8c6">(</span><span>currentNode</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#EDEDED">&amp;&amp;</span><span> </span><span class="token" style="color:#EDEDED">!</span><span class="token" style="color:#c5c8c6">[</span><span class="token" style="color:#A8FF60">&#x27;html&#x27;</span><span class="token" style="color:#c5c8c6">,</span><span> </span><span class="token" style="color:#A8FF60">&#x27;body&#x27;</span><span class="token" style="color:#c5c8c6">,</span><span> </span><span class="token" style="color:#A8FF60">&#x27;#document&#x27;</span><span class="token" style="color:#c5c8c6">]</span><span class="token" style="color:#c5c8c6">.</span><span class="token method property-access" style="color:#DAD085">includes</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#DAD085">getNodeName</span><span class="token" style="color:#c5c8c6">(</span><span>currentNode</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">4</span><span>    </span><span class="token control-flow" style="color:#96CBFE">if</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#DAD085">isContainingBlock</span><span class="token" style="color:#c5c8c6">(</span><span>currentNode</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">5</span><span>      </span><span class="token control-flow" style="color:#96CBFE">return</span><span> currentNode</span><span class="token" style="color:#c5c8c6">;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">6</span><span>    </span><span class="token" style="color:#c5c8c6">}</span><span> </span><span class="token control-flow" style="color:#96CBFE">else</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">7</span><span>      currentNode </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#DAD085">getParentNode</span><span class="token" style="color:#c5c8c6">(</span><span>currentNode</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">8</span><span>    </span><span class="token" style="color:#c5c8c6">}</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">9</span><span>  </span><span class="token" style="color:#c5c8c6">}</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">10</span><span>  </span><span class="token control-flow" style="color:#96CBFE">return</span><span> </span><span class="token null nil" style="color:#96CBFE">null</span><span class="token" style="color:#c5c8c6">;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">11</span><span></span><span class="token" style="color:#c5c8c6">}</span></span></code></div></div>
<p class="leading-8 break-all whitespace-normal mb-8 mt-8">关键函数在于：<code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">isContainingBlock</code>，这个是根据 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">mdn</code> 的描述来判断的：</p>
<div class="relative w-full text-sm undefined"><div class="shrink-0 grow basis-0" style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:20px;margin:0;overflow:auto;border-radius:6px;background:#1d1f21;max-height:400px;font-size:0.875rem"><code class="language-javascript" style="white-space:pre;color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">1</span><span class="token module" style="color:#96CBFE">export</span><span> </span><span class="token" style="color:#96CBFE">function</span><span> </span><span class="token" style="color:#DAD085">isContainingBlock</span><span class="token" style="color:#c5c8c6">(</span><span class="token parameter literal-property" style="color:#96CBFE">element</span><span class="token parameter" style="color:#EDEDED">:</span><span class="token parameter"> </span><span class="token parameter maybe-class-name">Element</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#EDEDED">:</span><span> boolean </span><span class="token" style="color:#c5c8c6">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">2</span><span>  </span><span class="token" style="color:#96CBFE">const</span><span> safari </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#DAD085">isSafari</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">3</span><span>  </span><span class="token" style="color:#96CBFE">const</span><span> css </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#DAD085">getComputedStyle</span><span class="token" style="color:#c5c8c6">(</span><span>element</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">4</span><span>  </span><span class="token" style="color:#7C7C7C">// https://developer.mozilla.org/en-US/docs/Web/CSS/Containing_block#identifying_the_containing_block</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">5</span><span>  </span><span class="token control-flow" style="color:#96CBFE">return</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">6</span><span>    css</span><span class="token" style="color:#c5c8c6">.</span><span class="token property-access">transform</span><span> </span><span class="token" style="color:#EDEDED">!==</span><span> </span><span class="token" style="color:#A8FF60">&#x27;none&#x27;</span><span> </span><span class="token" style="color:#EDEDED">||</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">7</span><span>    css</span><span class="token" style="color:#c5c8c6">.</span><span class="token property-access">perspective</span><span> </span><span class="token" style="color:#EDEDED">!==</span><span> </span><span class="token" style="color:#A8FF60">&#x27;none&#x27;</span><span> </span><span class="token" style="color:#EDEDED">||</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">8</span><span>    </span><span class="token" style="color:#c5c8c6">(</span><span>css</span><span class="token" style="color:#c5c8c6">.</span><span class="token property-access">containerType</span><span> </span><span class="token" style="color:#EDEDED">?</span><span> css</span><span class="token" style="color:#c5c8c6">.</span><span class="token property-access">containerType</span><span> </span><span class="token" style="color:#EDEDED">!==</span><span> </span><span class="token" style="color:#A8FF60">&#x27;normal&#x27;</span><span> </span><span class="token" style="color:#EDEDED">:</span><span> </span><span class="token" style="color:#99CC99">false</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#EDEDED">||</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">9</span><span>    </span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#EDEDED">!</span><span>safari </span><span class="token" style="color:#EDEDED">&amp;&amp;</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span>css</span><span class="token" style="color:#c5c8c6">.</span><span class="token property-access">backdropFilter</span><span> </span><span class="token" style="color:#EDEDED">?</span><span> css</span><span class="token" style="color:#c5c8c6">.</span><span class="token property-access">backdropFilter</span><span> </span><span class="token" style="color:#EDEDED">!==</span><span> </span><span class="token" style="color:#A8FF60">&#x27;none&#x27;</span><span> </span><span class="token" style="color:#EDEDED">:</span><span> </span><span class="token" style="color:#99CC99">false</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#EDEDED">||</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">10</span><span>    </span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#EDEDED">!</span><span>safari </span><span class="token" style="color:#EDEDED">&amp;&amp;</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span>css</span><span class="token" style="color:#c5c8c6">.</span><span class="token property-access">filter</span><span> </span><span class="token" style="color:#EDEDED">?</span><span> css</span><span class="token" style="color:#c5c8c6">.</span><span class="token property-access">filter</span><span> </span><span class="token" style="color:#EDEDED">!==</span><span> </span><span class="token" style="color:#A8FF60">&#x27;none&#x27;</span><span> </span><span class="token" style="color:#EDEDED">:</span><span> </span><span class="token" style="color:#99CC99">false</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#EDEDED">||</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">11</span><span>    </span><span class="token" style="color:#c5c8c6">[</span><span class="token" style="color:#A8FF60">&#x27;transform&#x27;</span><span class="token" style="color:#c5c8c6">,</span><span> </span><span class="token" style="color:#A8FF60">&#x27;perspective&#x27;</span><span class="token" style="color:#c5c8c6">,</span><span> </span><span class="token" style="color:#A8FF60">&#x27;filter&#x27;</span><span class="token" style="color:#c5c8c6">]</span><span class="token" style="color:#c5c8c6">.</span><span class="token method property-access" style="color:#DAD085">some</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#c5c8c6">(</span><span class="token parameter">value</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token arrow" style="color:#EDEDED">=&gt;</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span>css</span><span class="token" style="color:#c5c8c6">.</span><span class="token property-access">willChange</span><span> </span><span class="token" style="color:#EDEDED">||</span><span> </span><span class="token" style="color:#A8FF60">&#x27;&#x27;</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">.</span><span class="token method property-access" style="color:#DAD085">includes</span><span class="token" style="color:#c5c8c6">(</span><span>value</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#EDEDED">||</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">12</span><span>    </span><span class="token" style="color:#c5c8c6">[</span><span class="token" style="color:#A8FF60">&#x27;paint&#x27;</span><span class="token" style="color:#c5c8c6">,</span><span> </span><span class="token" style="color:#A8FF60">&#x27;layout&#x27;</span><span class="token" style="color:#c5c8c6">,</span><span> </span><span class="token" style="color:#A8FF60">&#x27;strict&#x27;</span><span class="token" style="color:#c5c8c6">,</span><span> </span><span class="token" style="color:#A8FF60">&#x27;content&#x27;</span><span class="token" style="color:#c5c8c6">]</span><span class="token" style="color:#c5c8c6">.</span><span class="token method property-access" style="color:#DAD085">some</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#c5c8c6">(</span><span class="token parameter">value</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token arrow" style="color:#EDEDED">=&gt;</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span>css</span><span class="token" style="color:#c5c8c6">.</span><span class="token property-access">contain</span><span> </span><span class="token" style="color:#EDEDED">||</span><span> </span><span class="token" style="color:#A8FF60">&#x27;&#x27;</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">.</span><span class="token method property-access" style="color:#DAD085">includes</span><span class="token" style="color:#c5c8c6">(</span><span>value</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">)</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">13</span><span>  </span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">14</span><span></span><span class="token" style="color:#c5c8c6">}</span></span></code></div></div>
<p class="leading-8 break-all whitespace-normal mb-8 mt-8">至此，我们就完成了 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">getOffsetParent</code> 函数的实现，也就是知道获取某个元素的定位上下文。</p>
<p class="leading-8 break-all whitespace-normal mb-8 mt-8">核心的逻辑其实很简单，只是实现上会有非常多的细节需要注意。</p>
<p class="leading-8 break-all whitespace-normal mb-8 mt-8">以下是整体求定位上下文的 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">x</code> 坐标和 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">y</code> 坐标完整逻辑。</p>
<div class="relative w-full text-sm undefined"><div class="shrink-0 grow basis-0" style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:20px;margin:0;overflow:auto;border-radius:6px;background:#1d1f21;max-height:400px;font-size:0.875rem"><code class="language-javascript" style="white-space:pre;color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">1</span><span class="token module" style="color:#96CBFE">export</span><span> </span><span class="token" style="color:#96CBFE">function</span><span> </span><span class="token" style="color:#DAD085">getCompositeRect</span><span class="token" style="color:#c5c8c6">(</span><span class="token parameter literal-property" style="color:#96CBFE">element</span><span class="token parameter" style="color:#EDEDED">:</span><span class="token parameter"> </span><span class="token parameter maybe-class-name">Element</span><span class="token parameter"> </span><span class="token parameter" style="color:#EDEDED">|</span><span class="token parameter"> </span><span class="token parameter maybe-class-name">VirtualElement</span><span class="token parameter" style="color:#c5c8c6">,</span><span class="token parameter"> </span><span class="token parameter literal-property" style="color:#96CBFE">offsetParent</span><span class="token parameter" style="color:#EDEDED">:</span><span class="token parameter"> </span><span class="token parameter maybe-class-name">Element</span><span class="token parameter"> </span><span class="token parameter" style="color:#EDEDED">|</span><span class="token parameter"> </span><span class="token parameter maybe-class-name">Window</span><span class="token parameter" style="color:#c5c8c6">,</span><span class="token parameter"> </span><span class="token parameter literal-property" style="color:#96CBFE">isFixed</span><span class="token parameter" style="color:#EDEDED">:</span><span class="token parameter"> boolean </span><span class="token parameter" style="color:#EDEDED">=</span><span class="token parameter"> </span><span class="token parameter" style="color:#99CC99">false</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#EDEDED">:</span><span> </span><span class="token maybe-class-name">Rect</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">2</span><span>  </span><span class="token" style="color:#96CBFE">const</span><span> isOffsetParentAnElement </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#DAD085">isHTMLElement</span><span class="token" style="color:#c5c8c6">(</span><span>offsetParent</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">3</span><span>  </span><span class="token" style="color:#96CBFE">const</span><span> documentElement </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#DAD085">getDocumentElement</span><span class="token" style="color:#c5c8c6">(</span><span>offsetParent</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">4</span><span>  </span><span class="token" style="color:#96CBFE">const</span><span> rect </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#DAD085">getBoundingClientRect</span><span class="token" style="color:#c5c8c6">(</span><span>element</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">5</span><span>  </span><span class="token" style="color:#96CBFE">let</span><span> scroll </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span> </span><span class="token literal-property" style="color:#96CBFE">scrollLeft</span><span class="token" style="color:#EDEDED">:</span><span> </span><span class="token" style="color:#FF73FD">0</span><span class="token" style="color:#c5c8c6">,</span><span> </span><span class="token literal-property" style="color:#96CBFE">scrollTop</span><span class="token" style="color:#EDEDED">:</span><span> </span><span class="token" style="color:#FF73FD">0</span><span> </span><span class="token" style="color:#c5c8c6">}</span><span class="token" style="color:#c5c8c6">;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">6</span><span>  </span><span class="token" style="color:#96CBFE">let</span><span> offsets </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span> </span><span class="token literal-property" style="color:#96CBFE">x</span><span class="token" style="color:#EDEDED">:</span><span> </span><span class="token" style="color:#FF73FD">0</span><span class="token" style="color:#c5c8c6">,</span><span> </span><span class="token literal-property" style="color:#96CBFE">y</span><span class="token" style="color:#EDEDED">:</span><span> </span><span class="token" style="color:#FF73FD">0</span><span> </span><span class="token" style="color:#c5c8c6">}</span><span class="token" style="color:#c5c8c6">;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">7</span><span>  </span><span class="token" style="color:#7C7C7C">// offsetParent 有可能是 window</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">8</span><span>  </span><span class="token control-flow" style="color:#96CBFE">if</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span>isOffsetParentAnElement </span><span class="token" style="color:#EDEDED">||</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#EDEDED">!</span><span>isOffsetParentAnElement </span><span class="token" style="color:#EDEDED">&amp;&amp;</span><span> </span><span class="token" style="color:#EDEDED">!</span><span>isFixed</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">9</span><span>    </span><span class="token control-flow" style="color:#96CBFE">if</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">10</span><span>      </span><span class="token" style="color:#DAD085">getNodeName</span><span class="token" style="color:#c5c8c6">(</span><span>offsetParent </span><span class="token module" style="color:#96CBFE">as</span><span> </span><span class="token maybe-class-name">Element</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#EDEDED">!==</span><span> </span><span class="token" style="color:#A8FF60">&#x27;body&#x27;</span><span> </span><span class="token" style="color:#EDEDED">||</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">11</span><span>      </span><span class="token" style="color:#7C7C7C">// https://github.com/popperjs/popper-core/issues/1078</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">12</span><span>      </span><span class="token" style="color:#DAD085">isScrollParent</span><span class="token" style="color:#c5c8c6">(</span><span>documentElement</span><span class="token" style="color:#c5c8c6">)</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">13</span><span>    </span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">14</span><span>      scroll </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#DAD085">getNodeScroll</span><span class="token" style="color:#c5c8c6">(</span><span>offsetParent </span><span class="token module" style="color:#96CBFE">as</span><span> </span><span class="token maybe-class-name">HTMLElement</span><span> </span><span class="token" style="color:#EDEDED">|</span><span> </span><span class="token maybe-class-name">Window</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">15</span><span>    </span><span class="token" style="color:#c5c8c6">}</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">16</span><span>    </span><span class="token control-flow" style="color:#96CBFE">if</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span>isOffsetParentAnElement</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">17</span><span>      offsets </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#DAD085">getBoundingClientRect</span><span class="token" style="color:#c5c8c6">(</span><span>offsetParent </span><span class="token module" style="color:#96CBFE">as</span><span> </span><span class="token maybe-class-name">HTMLElement</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">18</span><span>      offsets</span><span class="token" style="color:#c5c8c6">.</span><span class="token property-access">x</span><span> </span><span class="token" style="color:#EDEDED">+=</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span>offsetParent </span><span class="token module" style="color:#96CBFE">as</span><span> </span><span class="token maybe-class-name">HTMLElement</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">.</span><span class="token property-access">clientLeft</span><span class="token" style="color:#c5c8c6">;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">19</span><span>      offsets</span><span class="token" style="color:#c5c8c6">.</span><span class="token property-access">y</span><span> </span><span class="token" style="color:#EDEDED">+=</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span>offsetParent </span><span class="token module" style="color:#96CBFE">as</span><span> </span><span class="token maybe-class-name">HTMLElement</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">.</span><span class="token property-access">clientTop</span><span class="token" style="color:#c5c8c6">;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">20</span><span>    </span><span class="token" style="color:#c5c8c6">}</span><span> </span><span class="token control-flow" style="color:#96CBFE">else</span><span> </span><span class="token control-flow" style="color:#96CBFE">if</span><span> </span><span class="token" style="color:#c5c8c6">(</span><span>documentElement </span><span class="token module" style="color:#96CBFE">as</span><span> </span><span class="token maybe-class-name">HTMLElement</span><span class="token" style="color:#c5c8c6">)</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">21</span><span>      offsets</span><span class="token" style="color:#c5c8c6">.</span><span class="token property-access">x</span><span> </span><span class="token" style="color:#EDEDED">=</span><span> </span><span class="token" style="color:#DAD085">getWindowScrollBarX</span><span class="token" style="color:#c5c8c6">(</span><span>documentElement</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">22</span><span>    </span><span class="token" style="color:#c5c8c6">}</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">23</span><span>  </span><span class="token" style="color:#c5c8c6">}</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">24</span><span>  </span><span class="token control-flow" style="color:#96CBFE">return</span><span> </span><span class="token" style="color:#c5c8c6">{</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">25</span><span>    </span><span class="token literal-property" style="color:#96CBFE">x</span><span class="token" style="color:#EDEDED">:</span><span> rect</span><span class="token" style="color:#c5c8c6">.</span><span class="token property-access">left</span><span> </span><span class="token" style="color:#EDEDED">+</span><span> scroll</span><span class="token" style="color:#c5c8c6">.</span><span class="token property-access">scrollLeft</span><span> </span><span class="token" style="color:#EDEDED">-</span><span> offsets</span><span class="token" style="color:#c5c8c6">.</span><span class="token property-access">x</span><span class="token" style="color:#c5c8c6">,</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">26</span><span>    </span><span class="token literal-property" style="color:#96CBFE">y</span><span class="token" style="color:#EDEDED">:</span><span> rect</span><span class="token" style="color:#c5c8c6">.</span><span class="token property-access">top</span><span> </span><span class="token" style="color:#EDEDED">+</span><span> scroll</span><span class="token" style="color:#c5c8c6">.</span><span class="token property-access">scrollTop</span><span> </span><span class="token" style="color:#EDEDED">-</span><span> offsets</span><span class="token" style="color:#c5c8c6">.</span><span class="token property-access">y</span><span class="token" style="color:#c5c8c6">,</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">27</span><span>    </span><span class="token literal-property" style="color:#96CBFE">width</span><span class="token" style="color:#EDEDED">:</span><span> rect</span><span class="token" style="color:#c5c8c6">.</span><span class="token property-access">width</span><span class="token" style="color:#c5c8c6">,</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">28</span><span>    </span><span class="token literal-property" style="color:#96CBFE">height</span><span class="token" style="color:#EDEDED">:</span><span> rect</span><span class="token" style="color:#c5c8c6">.</span><span class="token property-access">height</span><span class="token" style="color:#c5c8c6">,</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">29</span><span>  </span><span class="token" style="color:#c5c8c6">}</span><span class="token" style="color:#c5c8c6">;</span><span>
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">30</span><span></span><span class="token" style="color:#c5c8c6">}</span></span></code></div></div>
<p class="leading-8 break-all whitespace-normal mb-8 mt-8">第一个细节：</p>
<ul class="list-disc p-0 m-6 space-y-4">
<li>首先在我们的组件里可以 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">absolute</code> 或者 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">fixed</code> , 所以在判断逻辑上会有不同，这里我们专注以 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">absolute</code> 为例。</li>
</ul>
<p class="leading-8 break-all whitespace-normal mb-8 mt-8">第二个细节：</p>
<ul class="list-disc p-0 m-6 space-y-4">
<li>如果我们的定位上下文是一个能滚动的容器，我们就可以获取滚动距离：<code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">scroll = getNodeScroll(offsetParent as HTMLElement | Window)</code>,
但注意 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">body</code> 如果是滚动容器，它的 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">scrollLeft</code> 和 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">scrollTop</code> 是 0，所以我们需要判断一下。这里会有同学说，那万一 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">body</code> 就是定位上下文并且
同样可以滚动怎么办？其实在我们之前 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">offsetParent</code> 的判断逻辑里，已经处理了这个情况，就是如果 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">body</code> 是定位上下文，并且 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">position</code> 是 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">static</code>，
那么就会返回 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">window</code> 作为定位上下文。</li>
</ul>
<p class="leading-8 break-all whitespace-normal mb-8 mt-8">第三个细节：</p>
<ul class="list-disc p-0 m-6 space-y-4">
<li>注意代码：<code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">offsets.x += (offsetParent as HTMLElement).clientLeft;</code>, 可以看到在减去 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">clientLeft</code>，这是因为 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">clientLeft</code> 是 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">border</code> 的宽度。
其实 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">getBoundingClientRect</code> 本身已经加上 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">width</code> 的宽度，这里又减去的目的是不想让 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">border</code> 算入定位中，其实在我看来没有特别的必要，所以我很可能后续要把这部分代码删掉。</li>
</ul>
<h2 class="font-medium mb-8 mt-8 text-[28px]" id="更多功能">更多功能</h2>
<p class="leading-8 break-all whitespace-normal mb-8 mt-8">还有一些核心的功能是弹框组件必须处理的。</p>
<ul class="list-disc p-0 m-6 space-y-4">
<li>监听所有跟元素有关滚动父容器的 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">scroll</code> 事件，以防在滚动过程中，定位失效。同理，<code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">window</code> 窗口的 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">resize</code> 事件也需要监听，以防窗口变化导致定位失效。</li>
<li>多种定位方式：例如 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">top</code>, <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">start-top</code>, <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">end-top</code>,<code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">bottom</code>, <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">left</code>,<code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">right</code>等等。</li>
<li>偏移功能：我们定位在下面，我想向左偏移 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">8px</code>，向下偏移 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">3px</code>，你是不是应该有暴露 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">api</code> 让用户可以自定义偏移量。</li>
<li>翻转功能：例如，定位置方式是 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">top</code>，也就是弹框向上，那么当你滚动容器的时候，向上的弹框即将被遮挡，这个时候你可以设置翻转功能，
当弹框被遮挡的时候，自动切换为 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">bottom</code> 定位方式。</li>
<li>固定功能：例如，是不是还有可能超出浏览器视口了，如下图：</li>
</ul>
<div class="w-full h-96 relative mt-8 mb-8 undefined"><img alt="popover" loading="lazy" decoding="async" data-nimg="fill" class="object-contain" style="position:absolute;height:100%;width:100%;left:0;top:0;right:0;bottom:0;color:transparent" src="/react-t-ui/popover/stick-before.webp"/></div>
<p class="leading-8 break-all whitespace-normal mb-8 mt-8">我们想自动处理，遇到超出就自动变为下方样子：</p>
<div class="w-full h-96 relative mt-8 mb-8 undefined"><img alt="popover" loading="lazy" decoding="async" data-nimg="fill" class="object-contain" style="position:absolute;height:100%;width:100%;left:0;top:0;right:0;bottom:0;color:transparent" src="/react-t-ui/popover/stick-after.webp"/></div>
<p class="leading-8 break-all whitespace-normal mb-8 mt-8">以上功能因为逻辑稍微还是有点复杂，我们采取的是中间件方式来实现，从最大程度降低耦合，以及降低代码理解难度，类似：</p>
<p class="leading-8 break-all whitespace-normal mb-8 mt-8">定位方向选择中间件 -&gt; 算出定位上下文的 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">x</code> 坐标和 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">y</code> 坐标 -&gt; 偏移量（<code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">x</code> 和 <code class="font-normal inline-block whitespace-nowrap bg-color-100 text-color-500 rounded-sm px-2 py-0.5 text-xs">y</code> 偏移多少）中间件-&gt; 滚动过程是否需要翻转中间件 -&gt; 滚动过程是否需要固定中间件 -&gt; 弹框组件最后效果</p>
<h2 class="font-medium mb-8 mt-8 text-[28px]" id="总结">总结</h2>
<p class="leading-8 break-all whitespace-normal mb-8 mt-8">最后，如果你想了解源码实现细节，欢迎加入到组件库交流群，里面会有直播解释源码和实现思路 。</p>
<p class="leading-8 break-all whitespace-normal mb-8 mt-8">同时如果你想让自己的简历有一些与众不同高难度的项目，也欢迎咨询，例如对于前端组件库项目，在询问你的前端技术栈和意愿的情况下，
可以帮助到初级前端到资深前端范围的求职者拥有一个亮眼的项目写在简历中，让你在面试时脱颖而出，给面试官一点惊喜😁。</p>
<h2 class="font-medium mb-8 mt-8 text-[28px]" id="附录">附录</h2>
<h3 class="font-medium mb-8 mt-8 text-[20px]" id="安装 Popover">安装 Popover</h3>
<div class="relative w-full text-sm undefined"><div class="shrink-0 grow basis-0" style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:20px;margin:0;overflow:auto;border-radius:6px;background:#1d1f21;max-height:400px;font-size:0.875rem"><code class="language-bash" style="white-space:pre;color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">1</span><span class="token" style="color:#DAD085">npm</span><span> i @t-headless-ui/react
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">2</span><span></span><span class="token" style="color:#DAD085">yarn</span><span> i @t-headless-ui/react
</span></span><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">3</span><span></span><span class="token" style="color:#DAD085">pnpm</span><span> i @t-headless-ui/react</span></span></code></div></div>
<h3 class="font-medium mb-8 mt-8 text-[20px]" id="引入 Popover">引入 Popover</h3>
<div class="relative w-full text-sm undefined"><div class="shrink-0 grow basis-0" style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:20px;margin:0;overflow:auto;border-radius:6px;background:#1d1f21;max-height:400px;font-size:0.875rem"><code class="language-tsx" style="white-space:pre;color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#7C7C7C">1</span><span class="token module" style="color:#96CBFE">import</span><span> </span><span class="token imports" style="color:#c5c8c6">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">Popover</span><span class="token imports"> </span><span class="token imports" style="color:#c5c8c6">}</span><span> </span><span class="token module" style="color:#96CBFE">from</span><span> </span><span class="token" style="color:#A8FF60">&#x27;@t-headless-ui/react&#x27;</span><span class="token" style="color:#c5c8c6">;</span></span></code></div></div></div><div class="hidden z-10 xl:flex xl:w-48 mt-8 pl-0 shrink-0"><div class="sticky top-[90px] overflow-y-auto h-[calc(100vh-100px)]"><div data-target-id="基础使用"><div class="text-color-500 text-[12px] cursor-pointer hover:text-primary-color mb-3">基础使用</div></div><div data-target-id="定位上下文"><div class="text-color-500 text-[12px] cursor-pointer hover:text-primary-color mb-3">定位上下文</div><div data-target-id="offsetParent 的坑"><div class="text-color-500 text-[12px] cursor-pointer hover:text-primary-color mb-3 ml-2">offsetParent 的坑</div></div></div><div data-target-id="更多功能"><div class="text-color-500 text-[12px] cursor-pointer hover:text-primary-color mb-3">更多功能</div></div><div data-target-id="总结"><div class="text-color-500 text-[12px] cursor-pointer hover:text-primary-color mb-3">总结</div></div><div data-target-id="附录"><div class="text-color-500 text-[12px] cursor-pointer hover:text-primary-color mb-3">附录</div><div data-target-id="安装 Popover"><div class="text-color-500 text-[12px] cursor-pointer hover:text-primary-color mb-3 ml-2">安装 Popover</div></div><div data-target-id="引入 Popover"><div class="text-color-500 text-[12px] cursor-pointer hover:text-primary-color mb-3 ml-2">引入 Popover</div></div></div></div></div><!--$--><!--/$--></main></div><script>$RB=[];$RV=function(a){$RT=performance.now();for(var b=0;b<a.length;b+=2){var c=a[b],e=a[b+1];null!==e.parentNode&&e.parentNode.removeChild(e);var f=c.parentNode;if(f){var g=c.previousSibling,h=0;do{if(c&&8===c.nodeType){var d=c.data;if("/$"===d||"/&"===d)if(0===h)break;else h--;else"$"!==d&&"$?"!==d&&"$~"!==d&&"$!"!==d&&"&"!==d||h++}d=c.nextSibling;f.removeChild(c);c=d}while(c);for(;e.firstChild;)f.insertBefore(e.firstChild,c);g.data="$";g._reactRetry&&requestAnimationFrame(g._reactRetry)}}a.length=0};
$RC=function(a,b){if(b=document.getElementById(b))(a=document.getElementById(a))?(a.previousSibling.data="$~",$RB.push(a,b),2===$RB.length&&("number"!==typeof $RT?requestAnimationFrame($RV.bind(null,$RB)):(a=performance.now(),setTimeout($RV.bind(null,$RB),2300>a&&2E3<a?2300-a:$RT+300-a)))):b.parentNode.removeChild(b)};$RC("B:0","S:0")</script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[40104,[\"/react-t-ui/_next/static/chunks/d821eddc5a83a14d.js\",\"/react-t-ui/_next/static/chunks/a45895e8a6f72ee9.js\"],\"ClientSegmentRoot\"]\n3:I[97688,[\"/react-t-ui/_next/static/chunks/07a06d645a86c72b.js\",\"/react-t-ui/_next/static/chunks/ef5d1ddf31034dc0.js\",\"/react-t-ui/_next/static/chunks/f129c4ead9cc822c.js\"],\"default\"]\n4:I[65932,[\"/react-t-ui/_next/static/chunks/d821eddc5a83a14d.js\",\"/react-t-ui/_next/static/chunks/a45895e8a6f72ee9.js\"],\"default\"]\n5:I[20542,[\"/react-t-ui/_next/static/chunks/d821eddc5a83a14d.js\",\"/react-t-ui/_next/static/chunks/a45895e8a6f72ee9.js\"],\"default\"]\n7:I[43720,[\"/react-t-ui/_next/static/chunks/07a06d645a86c72b.js\",\"/react-t-ui/_next/static/chunks/ef5d1ddf31034dc0.js\",\"/react-t-ui/_next/static/chunks/f129c4ead9cc822c.js\",\"/react-t-ui/_next/static/chunks/1b463402b9814e2f.js\",\"/react-t-ui/_next/static/chunks/1ebf659cd03b1565.js\"],\"default\"]\n9:I[11713,[\"/react-t-ui/_next/static/chunks/07a06d645a86c72b.js\",\"/react-t-ui/_next/static/chunks/ef5d1ddf31034dc0.js\",\"/react-t-ui/_next/static/chunks/f129c4ead9cc822c.js\",\"/react-t-ui/_next/static/chunks/1b463402b9814e2f.js\",\"/react-t-ui/_next/static/chunks/1ebf659cd03b1565.js\",\"/react-t-ui/_next/static/chunks/007e0171044f4757.js\",\"/react-t-ui/_next/static/chunks/f623eaf7cdb053fc.js\",\"/react-t-ui/_next/static/chunks/6119c141ed8a8242.js\"],\"MustRead\"]\na:I[88036,[\"/react-t-ui/_next/static/chunks/07a06d645a86c72b.js\",\"/react-t-ui/_next/static/chunks/ef5d1ddf31034dc0.js\",\"/react-t-ui/_next/static/chunks/f129c4ead9cc822c.js\",\"/react-t-ui/_next/static/chunks/1b463402b9814e2f.js\",\"/react-t-ui/_next/static/chunks/1ebf659cd03b1565.js\",\"/react-t-ui/_next/static/chunks/007e0171044f4757.js\",\"/react-t-ui/_next/static/chunks/f623eaf7cdb053fc.js\",\"/react-t-ui/_next/static/chunks/6119c141ed8a8242.js\"],\"Anchor\"]\nb:I[69438,[\"/react-t-ui/_next/static/chunks/07a06d645a86c72b.js\",\"/react-t-ui/_next/static/chunks/ef5d1ddf31034dc0.js\",\"/react-t-ui/_next/static/chunks/f129c4ead9cc822c.js\",\"/react-t-ui/_next/static/chunks/1b463402b9814e2f.js\",\"/react-t-ui/_next/static/chunks/1ebf659cd03b1565.js\",\"/react-t-ui/_next/static/chunks/007e0171044f4757.js\",\"/react-t-ui/_next/static/chunks/f623eaf7cdb053fc.js\",\"/react-t-ui/_next/static/chunks/6119c141ed8a8242.js\"],\"AnchorLink\"]\nc:I[37812,[\"/react-t-ui/_next/static/chunks/07a06d645a86c72b.js\",\"/react-t-ui/_next/static/chunks/ef5d1ddf31034dc0.js\",\"/react-t-ui/_next/static/chunks/f129c4ead9cc822c.js\",\"/react-t-ui/_next/static/chunks/1b463402b9814e2f.js\",\"/react-t-ui/_next/static/chunks/1ebf659cd03b1565.js\",\"/react-t-ui/_next/static/chunks/007e0171044f4757.js\",\"/react-t-ui/_next/static/chunks/f623eaf7cdb053fc.js\",\"/react-t-ui/_next/static/chunks/6119c141ed8a8242.js\"],\"LinkItem\"]\nd:I[6861,[\"/react-t-ui/_next/static/chunks/d821eddc5a83a14d.js\",\"/react-t-ui/_next/static/chunks/a45895e8a6f72ee9.js\"],\"OutletBoundary\"]\ne:\"$Sreact.suspense\"\n11:I[56272,[],\"default\"]\n:HL[\"/react-t-ui/_next/static/chunks/c57f25d7aa6d6db9.css\",\"style\"]\n:HL[\"/react-t-ui/_next/static/chunks/ec8a10aa2b532d44.css\",\"style\"]\n:HL[\"/react-t-ui/_next/static/chunks/373e08a226793c6d.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"JCsUNHoMPKLZv5brQoUut\",\"c\":[\"\",\"popover\"],\"q\":\"\",\"i\":false,\"f\":[[[\"\",{\"children\":[\"popover\",{\"children\":[\"__PAGE__\",{}]}]},\"$undefined\",\"$undefined\",true],[[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/react-t-ui/_next/static/chunks/c57f25d7aa6d6db9.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-0\",{\"src\":\"/react-t-ui/_next/static/chunks/07a06d645a86c72b.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-1\",{\"src\":\"/react-t-ui/_next/static/chunks/ef5d1ddf31034dc0.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-2\",{\"src\":\"/react-t-ui/_next/static/chunks/f129c4ead9cc822c.js\",\"async\":true,\"nonce\":\"$undefined\"}]],[\"$\",\"$L2\",null,{\"Component\":\"$3\",\"slots\":{\"children\":[\"$\",\"$L4\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]},\"serverProvidedParams\":{\"params\":{},\"promises\":[\"$@6\"]}}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"script\",\"script-0\",{\"src\":\"/react-t-ui/_next/static/chunks/1b463402b9814e2f.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-1\",{\"src\":\"/react-t-ui/_next/static/chunks/1ebf659cd03b1565.js\",\"async\":true,\"nonce\":\"$undefined\"}]],[\"$\",\"$L2\",null,{\"Component\":\"$7\",\"slots\":{\"children\":[\"$\",\"$L4\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]},\"serverProvidedParams\":{\"params\":\"$0:f:0:1:0:props:children:1:props:serverProvidedParams:params\",\"promises\":[\"$@8\"]}}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"div\",null,{\"className\":\"grow shrink basis-0 overflow-hidden mx-16 mt-8 mb-12\",\"children\":[\"$\",\"$L9\",null,{}]}],[\"$\",\"div\",null,{\"className\":\"hidden z-10 xl:flex xl:w-48 mt-8 pl-0 shrink-0\",\"children\":[\"$\",\"$La\",null,{\"offset\":-90,\"className\":\"sticky top-[90px] overflow-y-auto h-[calc(100vh-100px)]\",\"children\":[[\"$\",\"$Lb\",\"基础使用\",{\"targetId\":\"基础使用\",\"children\":[[\"$\",\"$Lc\",null,{\"item\":{\"level\":2,\"text\":\"基础使用\"}}],null]}],[\"$\",\"$Lb\",\"定位上下文\",{\"targetId\":\"定位上下文\",\"children\":[[\"$\",\"$Lc\",null,{\"item\":{\"level\":2,\"text\":\"定位上下文\",\"items\":[{\"level\":3,\"text\":\"offsetParent 的坑\"}]}}],[[\"$\",\"$Lb\",\"offsetParent 的坑\",{\"targetId\":\"offsetParent 的坑\",\"children\":[[\"$\",\"$Lc\",null,{\"item\":\"$0:f:0:1:1:children:1:children:0:props:children:0:1:props:children:props:children:1:props:children:0:props:item:items:0\"}],null]}]]]}],[\"$\",\"$Lb\",\"更多功能\",{\"targetId\":\"更多功能\",\"children\":[[\"$\",\"$Lc\",null,{\"item\":{\"level\":2,\"text\":\"更多功能\"}}],null]}],[\"$\",\"$Lb\",\"总结\",{\"targetId\":\"总结\",\"children\":[[\"$\",\"$Lc\",null,{\"item\":{\"level\":2,\"text\":\"总结\"}}],null]}],[\"$\",\"$Lb\",\"附录\",{\"targetId\":\"附录\",\"children\":[[\"$\",\"$Lc\",null,{\"item\":{\"level\":2,\"text\":\"附录\",\"items\":[{\"level\":3,\"text\":\"安装 Popover\"},{\"level\":3,\"text\":\"引入 Popover\"}]}}],[[\"$\",\"$Lb\",\"安装 Popover\",{\"targetId\":\"安装 Popover\",\"children\":[[\"$\",\"$Lc\",null,{\"item\":\"$0:f:0:1:1:children:1:children:0:props:children:0:1:props:children:props:children:4:props:children:0:props:item:items:0\"}],null]}],[\"$\",\"$Lb\",\"引入 Popover\",{\"targetId\":\"引入 Popover\",\"children\":[[\"$\",\"$Lc\",null,{\"item\":\"$0:f:0:1:1:children:1:children:0:props:children:0:1:props:children:props:children:4:props:children:0:props:item:items:1\"}],null]}]]]}]]}]}]],[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/react-t-ui/_next/static/chunks/ec8a10aa2b532d44.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/react-t-ui/_next/static/chunks/373e08a226793c6d.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-0\",{\"src\":\"/react-t-ui/_next/static/chunks/007e0171044f4757.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-1\",{\"src\":\"/react-t-ui/_next/static/chunks/f623eaf7cdb053fc.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-2\",{\"src\":\"/react-t-ui/_next/static/chunks/6119c141ed8a8242.js\",\"async\":true,\"nonce\":\"$undefined\"}]],[\"$\",\"$Ld\",null,{\"children\":[\"$\",\"$e\",null,{\"name\":\"Next.MetadataOutlet\",\"children\":\"$@f\"}]}]]}],{},null,false,false]},null,false,false]},[[\"$\",\"div\",\"l\",{\"className\":\"flex items-center justify-center h-screen bg-white\",\"children\":[\"$\",\"div\",null,{\"className\":\"animate-spin rounded-full h-16 w-16 border-t-4 border-blue-500 border-opacity-70\"}]}],[],[]],false,false],\"$L10\",false]],\"m\":\"$undefined\",\"G\":[\"$11\",[]],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"12:I[6861,[\"/react-t-ui/_next/static/chunks/d821eddc5a83a14d.js\",\"/react-t-ui/_next/static/chunks/a45895e8a6f72ee9.js\"],\"ViewportBoundary\"]\n14:I[6861,[\"/react-t-ui/_next/static/chunks/d821eddc5a83a14d.js\",\"/react-t-ui/_next/static/chunks/a45895e8a6f72ee9.js\"],\"MetadataBoundary\"]\n10:[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$L12\",null,{\"children\":\"$@13\"}],[\"$\",\"div\",null,{\"hidden\":true,\"children\":[\"$\",\"$L14\",null,{\"children\":[\"$\",\"$e\",null,{\"name\":\"Next.Metadata\",\"children\":\"$@15\"}]}]}],null]}]\n6:\"$0:f:0:1:0:props:children:1:props:serverProvidedParams:params\"\n8:\"$0:f:0:1:0:props:children:1:props:serverProvidedParams:params\"\n"])</script><script>self.__next_f.push([1,"13:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n"])</script><script>self.__next_f.push([1,"16:I[83528,[\"/react-t-ui/_next/static/chunks/d821eddc5a83a14d.js\",\"/react-t-ui/_next/static/chunks/a45895e8a6f72ee9.js\"],\"IconMark\"]\n15:[[\"$\",\"link\",\"0\",{\"rel\":\"icon\",\"href\":\"/react-t-ui/favicon.ico?favicon.176b088f.ico\",\"sizes\":\"128x128\",\"type\":\"image/x-icon\"}],[\"$\",\"$L16\",\"1\",{}]]\nf:null\n"])</script></body></html>